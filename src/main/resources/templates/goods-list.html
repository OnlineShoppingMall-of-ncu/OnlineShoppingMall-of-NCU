<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout}">
<link>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>AdminLTE 2 | General Form Elements</title>
<!-- Tell the browser to be responsive to screen width -->
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
<!-- Bootstrap 3.3.7 -->
<link rel="stylesheet" th:href="@{/adminlte/bower_components/bootstrap/dist/css/bootstrap.min.css}">
<!-- Font Awesome -->
<link rel="stylesheet" th:href="@{/adminlte/bower_components/font-awesome/css/font-awesome.min.css}">
<!-- Ionicons -->
<link rel="stylesheet" th:href="@{/adminlte/bower_components/Ionicons/css/ionicons.min.css}">
<!-- Theme style -->
<link rel="stylesheet" th:href="@{/adminlte/css/AdminLTE.min.css}">
<!-- AdminLTE Skins. Choose a skin from the css/skins
     folder instead of downloading all of them to reduce the load. -->
<link rel="stylesheet" th:href="@{/adminlte/css/skins/_all-skins.min.css}">
<link rel="stylesheet" th:href="@{/bootstrap-table/bootstrap-table.css}">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- jQuery 3 -->
<script th:src="@{/adminlte/bower_components/jquery/dist/jquery.min.js}"></script>
<!-- Bootstrap 3.3.7 -->
<script th:src="@{/adminlte/bower_components/bootstrap/dist/js/bootstrap.min.js}"></script>
<!-- FastClick -->
<script th:src="@{/adminlte/bower_components/fastclick/lib/fastclick.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/adminlte/js/adminlte.min.js}"></script>
<!-- AdminLTE for demo purposes -->
<script th:src="@{/adminlte/js/demo.js}"></script>
<script th:src="@{/bootstrap-table/bootstrap-table.min.js}"></script>
<script th:src="@{/bootstrap-table/locale/bootstrap-table-zh-CN.js}"></script>
<!--模态消息对话框插件-->
<script th:src="@{/js/sweetalert.min.js}"></script>
<link rel="stylesheet" type="text/css" th:href="@{/css/sweetalert.css}">



<!-- Google Font -->
<link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    <div th:replace="commons/public::toppublic"></div>
    <!-- Left side column. contains the logo and sidebar -->
    <div th:replace="commons/public::leftpublic"></div>
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                商品列表
            </h1>
        </section>
        <!-- Main content -->
        <section class="content">
            <div class="row">
                <div class="col-xs-12">
                    <div class="box box-info">
                        <div class="box-body">
                            <div id="toolbar">
                                <div class="form-inline" role="form">
                                    <div class="form-group">
                                        <label for="keyword">查询商品: </label>
                                        <input name="keyword" class="form-control" type="text" id="keyword">
                                    </div>
                                    <button id="searchBtn" type="submit" class="btn btn-primary" style="margin-left: 5px">
                                        查询商品
                                    </button>
                                    <a th:href="@{/goods/add}">
                                        <button id="createBtn" type="submit" class="btn btn-info" style="margin-left: 30px">
                                            添加商品
                                        </button>
                                    </a>
                                    <button id="deleteBtn" type="submit"  class="btn btn-danger">删除商品</button>
                                </div>
                            </div>
<!--                            <table id="dataTable" class="table table-hover table-responsive"-->
<!--                                   style="table-layout: fixed"></table>-->
                            <table id="dataTable" class="table table-hover table-responsive"
                                   style="table-layout: fixed" >
                                <tread>
                                    <tr>
                                        <th>商品编号</th>
                                        <th>描述</th>
                                        <th>类别</th>
                                        <th>价格</th>
                                        <th>所属店铺id</th>
                                        <th>操作</th>
                                    </tr>
                                </tread>
                                <tbody>
                                <tr th:each="tmp:${GoodsList}">
                                    <td th:text="${tmp.commodityid}"></td>
                                    <td th:text="${tmp.decription}"></td>
                                    <td th:text="${tmp.category}"></td>
                                    <td th:text="${tmp.price}"></td>
                                    <td th:text="${tmp.shopid}"></td>
                                    <td>
                                        <!--查看按钮-->
                                        <a class="btn btn-sm btn-primary">编辑</a>
                                        <!--删除按钮-->
                                        <a class="btn btn-sm btn-danger deleteBtn" th:href="@{/goods/deleteGoodsById/(commodityid=${tmp.commodityid})}">删除</a>

                                    </td>
                                </tr>

                                </tbody>

                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.row -->
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <div th:replace="commons/public::footpublic"></div>
    <div th:replace="commons/public::controlpublic"></div>
    <!-- Control Sidebar -->

    <!-- /.control-sidebar -->
    <!-- Add the sidebar's background. This div must be placed
         immediately after the control sidebar -->
    <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- <script>
    $('#dataTable').bootstrapTable({
        method: 'get',  //Ajax请求
        url: "/goods/api/searchGoods", //Ajax请求的地址
        dataField: "goods",       //Ajax请求返回的数据是哪个字段
        pageNumber: 1,                //分页初始在第几页
        pagination: true,             //是否分页
        queryParams: queryParams,     //查询参数
        sidePagination: 'server',     //后台分页
        pageSize: 10,                 //每页默认显示条数
        pageList: [5, 10, 20, 50],
        showRefresh: true,            //刷新按钮
        clickToSelect: true,          //点击选中当前行
        buttonsAlign: 'right',
        toolbar: '#toolbar',
        showColumns: true,
        columns: [
            {
                title: '全选',
                field: 'select',
                checkbox: true,
                width: 25,
                align: 'center',
            },
            {
                title: '商品ID',
                field: 'goodsid',
                width: 160,
                align: 'center'
            },
            {
                title: '商品名',
                field: 'goodsname',
                width: 160,
                align: 'center'
            },
            {
                title: '价格',
                field: 'price',
                width: 160,
                align: 'center'
            },
            {
                title: '数量',
                field: 'num',
                width: 160,
                align: 'center'
            },
            {
                title: '详细分类',
                field: 'detailcate',
                width: 160,
                align: 'center'
            },
            {
                title: '活动',
                field: 'activityid',
                width: 160,
                align: 'center'
            },
            {
                title: '编辑',
                width: 50,
                formatter: function (value, row, index, field) {
                    return [
                        '<a class="edit ml10" href="javascript:void(0)" title="Edit">',
                        '<i class="glyphicon glyphicon-edit"></i>',
                        '</a>',
                    ].join('');
                },
                events: {
                    'click .edit': function (e, value, row, index) {
                        edit(row.goodsid);
                    }
                },
                align: 'center'
            },
            {
                title: '删除',
                width: 50,
                formatter: function (value, row, index, field) {
                    return [
                        '<a class="remove ml10" href="javascript:void(0)" title="Delete">',
                        '<i class="glyphicon glyphicon-trash"></i>',
                        '</a>',
                    ].join('');
                },
                events: {
                    'click .remove': function (e, value, row, index) {
                        swal({
                                title: '您是否要删除?',
                                text: '你将无法恢复所删除的商品信息!',
                                type: 'warning',
                                showCancelButton: true,
                                confirmButtonText:'删除',
                                cancelButtonText: '返回',
                                closeOnConfirm:false,
                                closeOnCancel:false
                            },
                            function(isConfirm) {
                                if (isConfirm) {
                                    $.ajax({
                                        url:"/goods/delete?id=" + row.goodsid,
                                        type: "delete",
                                        success: function (result) {
                                            if(result){
                                                swal(result.msg);
                                                $("#dataTable").bootstrapTable('remove',{field:'goodsid',values:[parseInt(row.goodsid)]});
                                            }else{
                                                console.log("失败");
                                            }
                                        }
                                    });
                                } else if (isConfirm === false) {
                                    swal(
                                        '已取消',
                                        '您取消了删除操作',
                                        'error'
                                    );

                                }
                            });
                    }
                },
                align: 'center'
            },
            {
                title: '活动',
                width: 50,
                formatter: function (value, row, index, field) {
                    return [
                        '<a class="edit ml10" href="javascript:void(0)" title="Edit">',
                        '<i class="glyphicon glyphicon-plus"></i>',
                        '</a>',
                    ].join('');
                },
                events: {
                    'click .edit': function (e, value, row, index) {
                        getActivity();
                        $('#activity-goodsid').text(row.goodsid);
                    }
                },
                align: 'center'
            },
        ],
        locale: 'zh-CN',
        responseHandler: function (data) {
            return data;
        }
    });


    function queryParams(params) {
        var keyword = $('#keyword').val();
        keyword=$.trim(keyword);
        return {
            pageSize: params.limit,
            pageNum: params.offset / params.limit + 1,
            keyword: keyword
        }
    }

    //根据选中的goodsid得到商品的信息
    function edit(id){
        $.ajax({
            type:"GET",
            url:"/goods/get?id=" +id,
            dataType:"json",
            success:function (data) {
                if(data){
                    var goods=data;
                    $('#goodsid').val(goods.goodsid);
                    $('#goodsname').val(goods.goodsname);
                    $('#price').val(goods.price);
                    $('#num').val(goods.num);
                    $('#detailcate').val(goods.detailcate);
                    $('#description').val(goods.description);
                    $('#editGoodsModal').modal();
                }else{
                    alert("请重新勾选")
                }
            }
        });
    }

    //点击保存按钮触发事件保存商品的信息
    function editRequest(){
        var goodsid = $('#goodsid').val();
        var goodsname = $('#goodsname').val();
        var price = $('#price').val();
        var num = $('#num').val();
        var description = $('#description').val();
        var category = $('#category').val();
        var detailcate = $('#detailcate').val();
        $.ajax({
            type:"Post",
            url:"/goods/edit",
            data:{
                goodsid:goodsid,
                goodsname:goodsname,
                price:price,
                num:num,
                description:description,
                category:category,
                detailcate:detailcate,
            },
            success:function (result) {
                $('#editGoodsModal').modal('hide');
                swal(result.msg);
                $('#dataTable').bootstrapTable("refresh",{silent: true});
            },error:function () {
                alert("错误！！");
            }
        });
    }





    //点击按钮得到所有的活动信息
    function getActivity() {
        $.ajax({
            url: "/activity/show",
            type: "post",
            success: function (result) {
                if(result.code==100) {
                    $("#activity-id").empty();
                    activity = result.info.activities;
                    $.each(activity, function (index,item) {
                        $("#activity-id").append($("<option></option>").attr("value",item.activityid).append(item.activityid));
                    });
                    //showActInfo(1);
                    $('#activity-goods').modal({backdrop:'static'});
                    $("#activity-id").change(function () {
                        $.ajax({
                            type: "GET",
                            url:"/activity/get?id="+$("#activity-id").val(),
                            dataType:"json",
                            success:function (data) {
                                if(data){
                                    var activity =data;
                                    $('#activityname').text(activity.activityname);
                                    $('#activitydes').text(activity.activitydes);
                                    $('#discount').text(activity.discount);
                                    $('#fullprice').text(activity.fullprice);
                                    $('#reduceprice').text(activity.reduceprice);
                                    $('#fullnum').text(activity.fullnum);
                                    $('#reducenum').text(activity.reducenum);
                                }else
                                    alert("重新选择");
                            }
                        });
                    });
                } else {
                    alert("获取活动信息失败");
                }
            }
        });
    }



    //点击按钮保存商品的活动信息
    $(document).on("click","#saveActivity",function () {
        var goodsid = $("#activity-goodsid").text();
        var activityid = $("#activity-id").val();
        $.ajax({
            url:"/activity/update",
            type:"POST",
            data:{
                goodsid:goodsid,
                activityid:activityid
            },
            success:function (result) {
                $("#activity-goods").modal('hide');
                swal(result.msg);
                $('#dataTable').bootstrapTable("refresh",{silent: true});
            },
            error:function () {
                alert("添加失败");
            }
        });
    })




    $("#deleteBtn").click(function () {
        var selects = $('#dataTable').bootstrapTable('getSelections');//得到选中的数据
        if(selects.length === 0){
            swal('请选择要删除的商品');
            return false;
        }else{
            swal({
                    title: '您是否要删除?',
                    text: '你将无法恢复所删除的商品信息!',
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonText:'删除',
                    cancelButtonText: '返回',
                    closeOnConfirm:false,
                    closeOnCancel:false
                },
                function(isConfirm) {
                    if (isConfirm) {
                        var idArr=[];
                        for(var i=0;i<selects.length;i++){
                            idArr.push(selects[i].goodsid);
                        }
                        $.ajax({
                            url: '/goods/multiDel',
                            data:{
                                ids: idArr.join(",")
                            },
                            success: function(result){
                                swal(result.msg);
                                $("#dataTable").bootstrapTable('remove',{field: 'goodsid', values: idArr});
                            }
                        });
                    } else if (isConfirm === false) {
                        swal(
                            '已取消',
                            '您取消了删除操作',
                            'error'
                        );

                    }
                });
        }
    })




    $('#searchBtn').click(function () {
        $('#dataTable').bootstrapTable('refresh',{url:'/goods/api/searchGoods'});
    });

</script>
-->
<!--弹出层引入-->
<div th:replace="/commons/modal::editGoodsModal"></div>
<div th:replace="/commons/activity-good::activity-good"></div>
</body>
</html>
